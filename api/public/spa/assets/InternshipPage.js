import{u as O}from"./StudentApiService.js";import{u as re,_ as ne}from"./CreateCompanyModal.js";import{u as oe,_ as ie}from"./CreateTechnologyModal.js";import{u as ue}from"./index.js";import{e as H,A as Q,l as v,F as K,o as p,c as C,w as s,y as d,f as l,u as t,P as $,v as c,x as h,z as u,D as f,m as de,U as pe,r as ce,n as m,S as U,$ as ve,a0 as fe,T as Y,Y as _e,Z as V,H as I,p as me,t as T,s as E,_ as ge,R as D,L as F}from"./vendor.js";import{u as Z}from"./InternshipApiService.js";import{b as B}from"./AbstractApiService.js";const he={class:"flex gap-4"},ye=u("Envoyer"),xe=H({emits:["sent"],setup(G,{emit:b}){const k=O(),y=Q(),M=ue(),q=v(),S=v();K(async()=>{const o=await k.getAllStudents();o.data=o.data.filter(i=>i.id!=M.id),q.value=o.data.map(i=>({label:i.apogee+" "+i.first_name+" "+i._last_name,value:i.id,id:i.id,first_name:i.first_name,last_name:i.last_name,profile_picture:i.profile_picture,apogee:i.apogee}))});const x=o=>f("div",{},[f("div",{class:"m-2 p2 flex items-center gap-4"},[f("img",{src:o.profile_picture,class:"h-10 w-10 rounded-full"}),f("div",{},[o.first_name," ",o.last_name,f("span",{class:"block text-gray-400"},[o.apogee])])])]),g=({option:o})=>f("div",{},[o.first_name+" "+o.last_name+" "+o.apogee]),w=async()=>{try{await k.invite(S.value),y.success("Invitation envoy\xE9e"),b("sent")}catch{}};return(o,i)=>(p(),C(t(h),{title:"Inviter un coll\xE8gue",class:"w-1/2"},{default:s(()=>[d("div",he,[l(t($),{value:S.value,"onUpdate:value":i[0]||(i[0]=r=>S.value=r),options:q.value,filterable:"","render-label":x,"render-tag":g},null,8,["value","options"]),l(t(c),{onClick:w},{default:s(()=>[ye]),_:1})])]),_:1}))}});const we={class:"flex items-center gap-8"},Ee=d("h1",null,"Mon stage",-1),be=u(" Quiter ce stage "),ke=u(" Inviter un coll\xE8gue "),Se={key:0,class:"h-96 flex items-center justify-center"},Ce={key:1},Ue=u(" Ajouter un stage "),qe={key:1},Le={class:"my-4 grid grid-cols-2 gap-4"},Ne={class:"m-2 p2 flex items-center gap-4"},je=["src"],Ae={class:"block text-gray-400"},Ie={class:"grid grid-cols-2 gap-8"},Te={class:"flex items-center gap-8"},Me=u(" Ajouter une entreprise "),Re={class:"flex items-center gap-8"},$e=u(" Ajouter une technologie "),Ve=u(" Mettre \xE0 jour "),De=u("Brouillon du rapport"),Fe=d("p",null,"Upload d'un fichier pdf, word ou powerpoint, avec un max de 40Mo",-1),Be=u("Upload du brouillon du rapport"),Pe=["href"],ze=u("Telecharger"),Oe=u("Version final du rapport"),He=d("p",null,"Upload d'un fichier pdf, word ou powerpoint, avec un max de 40Mo",-1),Qe=u("Upload du version final du rapport"),Ke=["href"],Ye=u("Telecharger"),Ze=u("Pr\xE9sentation du rapport"),Ge=d("p",null,"Upload d'un fichier pdf, word ou powerpoint, avec un max de 40Mo",-1),Je=u("Upload de la pr\xE9sentation du rapport"),We=["href"],Xe=u("Telecharger"),ot=H({setup(G){const b=O(),k=Z(),y=Z(),M=re(),q=oe();de();const S=pe(),x=Q(),g=v(!1),w=v(!1),o=v(0),i=v(null),r=v({title:"",description:"",supervisor_name:"",supervisor_phone:"",company_id:0,technologies:[]}),L=v([]),N=v(!1),J=n=>{L.value.push(n),r.value.company_id=n.value,N.value=!1},j=v([]),A=v(!1),W=n=>{j.value.push(n),r.value.technologies.push(n.value),A.value=!1};K(async()=>{const n=await b.getProfile();n.data.internship!=null&&(g.value=!0),r.value=n.data.internship,Array.isArray(r.value.technologies)&&(r.value.technologies=r.value.technologies.map(e=>e.id));const a=await M.get();L.value=a.data.map(e=>({value:e.id,label:e.name+" "+e.city,name:e.name,city:e.city}));const _=await q.get();j.value=_.data.map(e=>({label:e.name,value:e.id}))});const X=n=>f("div",{class:"px-2 py-1"},[f("div",{class:"mb-1"},[n.name]),f("div",{class:"mb-1 text-gray-300"},[n.city])]),ee=({option:n})=>f("div",{},[n.name]),te={title:[{required:!0,trigger:["input","blur"],validator:(n,a)=>a?a.length>255?new Error("Le titre ne peut pas contenir plus de 255 caract\xE8res"):!0:new Error("Le titre est requis")}],description:[{trigger:["input","blur"],validator:(n,a)=>a.length>2e3?new Error("La description ne peut pas contenir plus de 2000 caract\xE8res"):!0}],supervisor_name:[{required:!0,trigger:["input","blur"],validator:(n,a)=>a?a.length>255?new Error("Le nom de l'encadrant ne peut pas contenir plus de 255 caract\xE8res"):!0:new Error("Le nom de l'encadrant est requis")}],supervisor_phone:[{required:!0,trigger:["input","blur"],validator:(n,a)=>a?a.length>20?new Error("Le numero de l'encadrant ne peut pas contenir plus de 20 caract\xE8res"):!0:new Error("Le numero de l'encadrant est requis")}],company_id:[{required:!0,trigger:["input","blur"],validator:(n,a)=>{const _=L.value.map(e=>e.value);if(a){if(!_.includes(a))return new Error("L'entreprise est invalide")}else return new Error("L'entreprise est requise");return!0}}],technologies:[{required:!0,trigger:["input","blur"],validator:(n,a)=>{const _=j.value.map(e=>e.value);return!a||a.length==0?new Error("Les technologies sont requises"):a.every(e=>_.includes(e))?!0:new Error("L'entreprise est invalide")}}]},ae=n=>{n.preventDefault(),i.value.validate(async a=>{a?x.error("Il y a un probl\xE8me avec votre formulaire, veuillez r\xE9essayer"):(await k.update(r.value),x.success("Stage modifi\xE9 avec succ\xE8s"))})},R=async(n,{file:a},_="ok")=>{x.info("Uploading...");const e=new FormData;e.append(n,a.file),y.uploadFile(n,e).then(async P=>{x.success(_);const z=await b.getProfile();z.data.internship!=null&&(g.value=!0),r.value=z.data.internship,Array.isArray(r.value.technologies)&&(r.value.technologies=r.value.technologies.map(se=>se.id))}).finally(()=>{o.value++})},le=async()=>{S.warning({title:"Quiter votre stage actuel stage",content:"\xCAtes-vous s\xFBr de vouloir quitter votre stage actuel ?",positiveText:"Oui",negativeText:"Non, anuller",onPositiveClick:async()=>{await k.quit(),r.value=null,g.value=!1}})};return(n,a)=>{const _=ce("router-link");return p(),m(Y,null,[d("div",null,[d("div",we,[Ee,g.value?(p(),C(t(c),{key:0,type:"error",onClick:le},{default:s(()=>[be]),_:1})):U("",!0),g.value&&Array.isArray(r.value.colleagues)&&r.value.colleagues.length<2?(p(),C(t(c),{key:1,type:"success",onClick:a[0]||(a[0]=e=>w.value=!0)},{default:s(()=>[ke]),_:1})):U("",!0)]),t(b).isLoading.value?(p(),m("div",Se,[l(t(ve),{size:"large"})])):(p(),m("div",Ce,[g.value?(p(),m("div",qe,[d("div",Le,[(p(!0),m(Y,null,_e(r.value.colleagues,e=>(p(),C(t(h),null,{default:s(()=>[d("div",Ne,[d("img",{src:e.profile_picture,class:"h-10 w-10 rounded-full"},null,8,je),d("div",null,[u(I(e.first_name)+" "+I(e.last_name)+" ",1),d("span",Ae,I(e.apogee),1)])])]),_:2},1024))),256))]),l(t(h),{class:"mb-4"},{default:s(()=>[l(t(me),{model:r.value,ref:(e,P)=>{P.formRef=e,i.value=e},rules:te},{default:s(()=>[l(t(E),{path:"title",label:"Intitul\xE9 du sujet"},{default:s(()=>[l(t(T),{value:r.value.title,"onUpdate:value":a[1]||(a[1]=e=>r.value.title=e),placeholder:"Intitul\xE9 du sujet"},null,8,["value"])]),_:1}),l(t(E),{path:"description",label:"Description"},{default:s(()=>[l(t(T),{value:r.value.description,"onUpdate:value":a[2]||(a[2]=e=>r.value.description=e),type:"textarea",placeholder:"Description"},null,8,["value"])]),_:1}),d("div",Ie,[l(t(E),{path:"supervisor_name",label:"Nom et le pr\xE9nom de l'encadrant"},{default:s(()=>[l(t(T),{value:r.value.supervisor_name,"onUpdate:value":a[3]||(a[3]=e=>r.value.supervisor_name=e),placeholder:"Nom et le pr\xE9nom de l'encadrant"},null,8,["value"])]),_:1}),l(t(E),{path:"supervisor_phone",label:"Telephone de l'encadrant "},{default:s(()=>[l(t(T),{value:r.value.supervisor_phone,"onUpdate:value":a[4]||(a[4]=e=>r.value.supervisor_phone=e),placeholder:"Telephone de l'encadrant "},null,8,["value"])]),_:1})]),d("div",Te,[l(t(c),{onClick:a[5]||(a[5]=e=>N.value=!0)},{default:s(()=>[Me]),_:1}),l(t(E),{path:"company_id",label:"Entreprise",class:"w-full"},{default:s(()=>[l(t($),{value:r.value.company_id,"onUpdate:value":a[6]||(a[6]=e=>r.value.company_id=e),options:L.value,"render-label":X,"render-tag":ee,filterable:""},null,8,["value","options"])]),_:1})]),d("div",Re,[l(t(c),{onClick:a[7]||(a[7]=e=>A.value=!0)},{default:s(()=>[$e]),_:1}),l(t(E),{path:"technologies",label:"Technologies",class:"w-full"},{default:s(()=>[l(t($),{value:r.value.technologies,"onUpdate:value":a[8]||(a[8]=e=>r.value.technologies=e),options:j.value,multiple:"",filterable:""},null,8,["value","options"])]),_:1})]),l(t(ge),null,{default:s(()=>[l(t(c),{onClick:ae},{default:s(()=>[Ve]),_:1})]),_:1})]),_:1},8,["model"]),l(t(V),{show:N.value,"onUpdate:show":a[9]||(a[9]=e=>N.value=e)},{default:s(()=>[l(ne,{onCreated:J})]),_:1},8,["show"]),l(t(V),{show:A.value,"onUpdate:show":a[10]||(a[10]=e=>A.value=e)},{default:s(()=>[l(ie,{onCreated:W})]),_:1},8,["show"])]),_:1}),l(t(h),{title:"Upload des fichier"},{default:s(()=>[(p(),m("div",{class:"grid gap-4",key:o.value},[l(t(h),null,{default:s(()=>[l(t(D),null,{default:s(()=>[De]),_:1}),Fe,l(t(F),{style:{display:"inline-block",width:"fit-content",height:"fit-content"},multiple:!1,customRequest:e=>R("draft",e,"Votre brouillon du rapport a \xE9t\xE9 mise \xE0 jour"),accept:".pdf,.doc,.docx,.ppt,.pptx"},{default:s(()=>[l(t(c),{loading:t(y).isLoading.value},{default:s(()=>[Be]),_:1},8,["loading"])]),_:1},8,["customRequest"]),r.value.draft_report?(p(),m("a",{key:0,href:t(B)+r.value.draft_report,target:"_blank"},[l(t(c),{class:"ml-4",type:"success"},{default:s(()=>[ze]),_:1})],8,Pe)):U("",!0)]),_:1}),l(t(h),null,{default:s(()=>[l(t(D),null,{default:s(()=>[Oe]),_:1}),He,l(t(F),{style:{display:"inline-block",width:"fit-content",height:"fit-content"},multiple:!1,customRequest:e=>R("final",e,"Votre rapport a \xE9t\xE9 mise \xE0 jour"),accept:".pdf,.doc,.docx,.ppt,.pptx"},{default:s(()=>[l(t(c),{loading:t(y).isLoading.value},{default:s(()=>[Qe]),_:1},8,["loading"])]),_:1},8,["customRequest"]),r.value.final_report?(p(),m("a",{key:0,href:t(B)+r.value.final_report,target:"_blank"},[l(t(c),{class:"ml-4",type:"success"},{default:s(()=>[Ye]),_:1})],8,Ke)):U("",!0)]),_:1}),l(t(h),null,{default:s(()=>[l(t(D),null,{default:s(()=>[Ze]),_:1}),Ge,l(t(F),{style:{display:"inline-block",width:"fit-content",height:"fit-content"},multiple:!1,customRequest:e=>R("presentation",e,"Votre pr\xE9sentation a \xE9t\xE9 mise \xE0 jour"),accept:".pdf,.doc,.docx,.ppt,.pptx"},{default:s(()=>[l(t(c),{loading:t(y).isLoading.value},{default:s(()=>[Je]),_:1},8,["loading"])]),_:1},8,["customRequest"]),r.value.presentation?(p(),m("a",{key:0,href:t(B)+r.value.presentation,target:"_blank"},[l(t(c),{class:"ml-4",type:"success"},{default:s(()=>[Xe]),_:1})],8,We)):U("",!0)]),_:1})]))]),_:1})])):(p(),C(t(fe),{key:0,status:"warning",title:"Vous n'avez pas encore de stage",description:"cr\xE9ez votre stage maintenant"},{footer:s(()=>[l(_,{to:{name:"auth.students.internship.create"}},{default:s(()=>[l(t(c),{type:"success"},{default:s(()=>[Ue]),_:1})]),_:1},8,["to"])]),_:1}))]))]),l(t(V),{show:w.value,"onUpdate:show":a[12]||(a[12]=e=>w.value=e)},{default:s(()=>[l(xe,{onSent:a[11]||(a[11]=e=>w.value=!1)})]),_:1},8,["show"]),d("pre",null,I(r.value),1)],64)}}});export{ot as default};
